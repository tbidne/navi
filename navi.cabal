cabal-version:      2.4
name:               navi
version:            0.1
license:            MIT
license-file:       LICENSE
tested-with:        GHC ==9.2.4 || ==9.4.2
copyright:          2021 Thomas Bidne
author:             Thomas Bidne
maintainer:         tbidne@protonmail.com
homepage:           https://github.com/tbidne/navi/
bug-reports:        https://github.com/tbidne/navi/issues
synopsis:           A utility program for sending system notifications.
description:
  Please see the README at https://github.com/tbidne/navi/#readme

category:           System, Notifications
extra-source-files:
  CHANGELOG.md
  README.md

source-repository head
  type:     git
  location: https://github.com/tbidne/navi

common common-exts
  default-extensions:
    NoFieldSelectors
    NoImplicitPrelude
    NoStarIsType
    ApplicativeDo
    DataKinds
    DerivingVia
    DuplicateRecordFields
    FunctionalDependencies
    LambdaCase
    OverloadedLabels
    OverloadedStrings
    TypeFamilies

library
  import:           common-exts
  exposed-modules:
    Navi
    Navi.Args
    Navi.Config
    Navi.Config.Toml
    Navi.Config.Types
    Navi.Data.NaviLog
    Navi.Data.NaviNote
    Navi.Data.PollInterval
    Navi.Effects
    Navi.Effects.MonadNotify
    Navi.Effects.MonadSystemInfo
    Navi.Env.Core
    Navi.Env.DBus
    Navi.Env.NotifySend
    Navi.Event
    Navi.Event.Toml
    Navi.Event.Types
    Navi.NaviT
    Navi.Prelude
    Navi.Services.Battery.Common
    Navi.Services.Battery.Percentage
    Navi.Services.Battery.Percentage.Toml
    Navi.Services.Battery.Status
    Navi.Services.Battery.Status.Toml
    Navi.Services.Custom.Multiple
    Navi.Services.Custom.Multiple.Toml
    Navi.Services.Custom.Single
    Navi.Services.Custom.Single.Toml
    Navi.Services.Network.NetInterfaces
    Navi.Services.Network.NetInterfaces.Toml
    Navi.Services.Types
    Navi.Utils

  build-depends:
    , base                    >=4.14.1.0  && <4.18
    , bytestring              >=0.10.10.0 && <0.12
    , containers              >=0.5.11.0  && <0.7
    , dbus                    ^>=1.2.14
    , deepseq                 ^>=1.4.6.0
    , directory               ^>=1.3.5.0
    , fdo-notify              ^>=0.3.1
    , filepath                ^>=1.4.2.1
    , gitrev                  >=1.2.0     && <1.4
    , monad-callstack         ^>=0.1
    , monad-fs                ^>=0.1
    , monad-ioref             ^>=0.1
    , monad-logger            ^>=0.3.30
    , monad-logger-namespace  ^>=0.1
    , monad-stm               ^>=0.1
    , monad-thread            ^>=0.1
    , monad-time              ^>=0.1
    , mtl                     >=2.2.2     && <2.4
    , optics-core             ^>=0.4
    , optics-th               ^>=0.4
    , optparse-applicative    >=0.16.1.0  && <0.18
    , package-version         >=0.1.0.0   && <0.4
    , process                 ^>=1.6.9.0
    , pythia                  ^>=0.1
    , relative-time           ^>=0.1
    , smart-math              ^>=0.1
    , stm                     ^>=2.5.0
    , text                    >=1.2.3.2   && <2.1
    , toml-reader             ^>=0.1.0.0
    , unliftio                ^>=0.2.0.0

  hs-source-dirs:   src
  default-language: GHC2021

executable navi
  import:           common-exts
  main-is:          Main.hs
  build-depends:
    , base
    , directory
    , filepath
    , navi

  hs-source-dirs:   app
  ghc-options:      -threaded -with-rtsopts=-N
  default-language: GHC2021

test-suite unit
  import:           common-exts
  type:             exitcode-stdio-1.0
  main-is:          Main.hs
  other-modules:
    Unit.Navi.Config
    Unit.Navi.Config.Toml
    Unit.Navi.Services.Battery.Percentage.Toml
    Unit.Navi.Services.Battery.Status.Toml
    Unit.Navi.Services.Custom.Multiple.Toml
    Unit.Navi.Services.Custom.Single.Toml
    Unit.Navi.Services.Network.NetInterfaces.Toml
    Unit.Prelude

  build-depends:
    , base
    , fdo-notify
    , navi
    , pythia
    , smart-math
    , tasty        >=1.1.0.3 && <1.5
    , tasty-hunit  >=0.9     && <0.11
    , text

  hs-source-dirs:   test/unit
  default-language: GHC2021

test-suite integration
  import:           common-exts
  type:             exitcode-stdio-1.0
  main-is:          Main.hs
  other-modules:
    Integration.MockApp
    Integration.Prelude

  build-depends:
    , base
    , directory
    , fdo-notify
    , filepath
    , monad-logger-namespace
    , navi
    , pythia
    , smart-math
    , stm
    , tasty
    , tasty-hunit
    , text
    , unliftio

  hs-source-dirs:   test/integration
  default-language: GHC2021
